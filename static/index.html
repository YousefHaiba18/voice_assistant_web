<!DOCTYPE html>
<html>
<head>
  <title>Voice Assistant</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 2em;
    }
    button {
      font-size: 1.3em;
      padding: 1em 2em;
      margin-top: 1em;
    }
  </style>
</head>
<body>
  <h2>üéôÔ∏è Tap to Start / Stop Recording</h2>
  <button id="recordBtn">‚ñ∂Ô∏è Start Recording</button>
  <p id="status"></p>

  <script>
    let isRecording = false;
    let mediaRecorder;
    let audioChunks = [];
    let stream;
    const recordBtn = document.getElementById("recordBtn");
    const statusText = document.getElementById("status");

    async function initMic() {
      try {
        stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        console.log("Mic access granted");
        return true;
      } catch (err) {
        statusText.textContent = "‚ùå Microphone permission denied.";
        console.error("Mic error:", err);
        return false;
      }
    }

    recordBtn.onclick = async () => {
      if (!isRecording) {
        const micOk = await initMic();
        if (!micOk) return;

        statusText.textContent = "üé§ Recording...";
        mediaRecorder = new MediaRecorder(stream);
        audioChunks = [];
        mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
        mediaRecorder.start();

        isRecording = true;
        recordBtn.textContent = "‚èπ Stop Recording";
      } else {
        mediaRecorder.stop();
        statusText.textContent = "‚è≥ Sending...";
        isRecording = false;
        recordBtn.textContent = "‚ñ∂Ô∏è Start Recording";

        mediaRecorder.onstop = async () => {
          const audioBlob = new Blob(audioChunks, { type: "audio/wav" });
          const formData = new FormData();
          formData.append("audio", audioBlob, "recording.wav");

          const response = await fetch("/upload", {
            method: "POST",
            body: formData
          });

          const audioURL = URL.createObjectURL(await response.blob());
          const audio = new Audio(audioURL);
          audio.play();
          statusText.textContent = "‚úÖ Response played.";
        };
      }
    };
  </script>
</body>
</html>
